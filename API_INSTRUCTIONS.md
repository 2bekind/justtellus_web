# Инструкция по настройке API для мини-приложения

## Шаг 1: Установка зависимостей

Установите дополнительные библиотеки для API:

```bash
pip install flask flask-cors
```

Или используйте requirements.txt:

```bash
pip install -r requirements.txt
```

## Шаг 2: Запуск API сервера

### Вариант A: Локальная разработка

1. Откройте новый терминал (не закрывая бота)
2. Запустите API сервер:

```bash
python api_server.py
```

Сервер запустится на `http://localhost:5000`

### Вариант B: Запуск вместе с ботом

Создайте файл `start_all.bat`:

```batch
@echo off
start "Bot" python bot.py
start "API" python api_server.py
pause
```

## Шаг 3: Настройка URL в HTML

Откройте `profile.html` и найдите строку:

```javascript
const API_URL = 'http://localhost:5000'; // ИЗМЕНИТЕ НА ВАШ АДРЕС
```

### Для локальной разработки:
- Оставьте `http://localhost:5000`

### Для продакшена (хостинг):
- Замените на ваш домен: `https://ваш-домен.com`
- Убедитесь, что API сервер доступен по этому адресу

## Шаг 4: Развертывание на хостинге

### Варианты хостинга:

1. **Heroku** (бесплатно):
   - Создайте аккаунт на heroku.com
   - Установите Heroku CLI
   - Создайте `Procfile`:
     ```
     web: python api_server.py
     ```
   - Задеплойте: `git push heroku main`

2. **PythonAnywhere** (бесплатно):
   - Создайте аккаунт на pythonanywhere.com
   - Загрузите файлы через веб-интерфейс
   - Настройте веб-приложение

3. **Railway** (бесплатно):
   - Создайте аккаунт на railway.app
   - Подключите GitHub репозиторий
   - Автоматический деплой

4. **VPS сервер**:
   - Используйте nginx + gunicorn
   - Настройте SSL сертификат

## Шаг 5: Настройка мини-приложения в Telegram

1. Откройте @BotFather в Telegram
2. Найдите вашего бота
3. Отправьте `/newapp`
4. Выберите бота
5. Укажите название мини-приложения
6. Загрузите `profile.html` на хостинг (GitHub Pages, Netlify, Vercel)
7. Укажите URL к HTML файлу
8. Укажите URL к API: `https://ваш-домен.com/api/stats/{user_id}`

## Шаг 6: Проверка работы

1. Запустите API сервер
2. Откройте мини-приложение в боте
3. Проверьте, что статистика загружается

### Тестирование API вручную:

Откройте в браузере:
```
http://localhost:5000/api/stats/8109892353
```

Должен вернуться JSON с статистикой.

## Важные замечания

- API сервер должен работать постоянно (как и бот)
- Для продакшена используйте `gunicorn` или `waitress` вместо встроенного сервера Flask
- Настройте CORS правильно для вашего домена
- Используйте HTTPS в продакшене
- Добавьте аутентификацию для безопасности (опционально)

## Пример запуска с gunicorn (продакшен)

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 api_server:app
```

